

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

<style>
    .fa fa-times {    
        color:red;
    }
    .fa fa-check {
        color:green;    
    }

    #loadingDiv {
        position: absolute;
        top: 0px;
        right: 0px;
        width: 100%;
        height: 100%;
        background-color: #666;
        background-image: url('../../Content/images/hex-loader2.gif');
        background-repeat: no-repeat;
        background-position: center;
        z-index: 10000000;
        opacity: 0.4;
        filter: alpha(opacity=40); 
    }
</style>


<div class="panel-group">

    <div class="panel-body" style="">
        <h2>Asistencia del Grupo</h2>
    </div>

    <div class="panel-body">

        <div class="form-group">
            @Html.Hidden("grupoId", new { Value = @ViewBag.grupoId })
            <div class="control-label col-md-2">
                @Html.Label("Fechas del Calendario", new { @class = "" })
            </div>
            <div class="col-md-10">
                @Html.DropDownList("fecha", (IEnumerable<SelectListItem>)ViewBag.fechas, "--Seleccione la Fecha--", new { @class = "form-control" })
            </div>
        </div>

        <table id="tblAsistencia" class="table table-striped" style="margin-top:100px;">
            <tr>
                <th>Id</th>
                <th>Nombre</th>
                <th>Asistió</th>
            </tr>
            <tbody>
            </tbody>
        </table>
    </div>
</div>
<div class="modal fade" id="CreateModal" tabindex="-1" role="dialog" aria-labelledby="CreateModal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body" id="modalBody">
            </div>
        </div>
    </div>
</div>

<div id="loadingDiv" style="margin: 0 auto;">

</div>


@section Scripts {
    @Scripts.Render("~/bundles/jquery")
    <script type="text/javascript">
        $(function () {
            $("#loadingDiv").hide();

            $("#fecha").on('change', function () {
                var value = $(this).val();
                if (value != '') {
                    var grupoId = $("#grupoId").val();
                    if (grupoId != undefined) {
                        $("#tblAsistencia tbody").html("");
                        getAsistenciaParticipantes(grupoId, value);
                    }

                }

            });


        });


        function getAsistenciaParticipantes(grupoId, eventoId) {
            var count = 0;

            $("#loadingDiv").show();
            $.ajax({
                url: "/Grupo/getAsistenciaParticipantesGrupo",
                type: "GET",
                data: { grupoId: grupoId, eventoId: eventoId },
                success: function (result) {
                    $("#tblAsistencia tbody").html("<tr><th>ID</th><th>Nombre</th><th>Asistió?</th></tr>");
                    $.each(result, function (k, v) {
                        var tdAsistio = "";
                         if (v.asistio == false) {
                            tdAsistio = "<td id='participante_" + v.participanteId + "' onclick='quitarAusencia(" + eventoId + "," + v.participanteId + ")'> <i style='color:red;font-size:1.5em' class='fa fa-times'></i></td>";
                        }
                        if (v.asistio == true) {
                            tdAsistio = "<td id='participante_" + v.participanteId + "' onclick='registrarAusencia(" + eventoId + "," + v.participanteId + ")'>  <i style='color:green;font-size:1.5em' class='fa fa-check'></i></td>";
                        }
                        $("#tblAsistencia").append("<tr><td>" + v.cedula + "</td><td>" + v.nombre + "</td>" + tdAsistio + "</tr>");
                    });
                    $("#loadingDiv").hide();
                }
            });


        }



        function registrarAusencia(eventoID, participanteID) {

           $.ajax({
                url: "/Ausencia/CreateAusencia?eventoID=" + eventoID + "&participanteID=" + participanteID,
                type: "POST",
                success: function (result) {
                    $("#participante_" + participanteID).find("i").toggleClass('fa fa-times fa fa-check');
                
                }
            });

        }

        function quitarAusencia(eventoID, participanteID) {
            $.ajax({
                url: "/Ausencia/DeleteAusencia?eventoID=" + eventoID + "&participanteID=" + participanteID,
                type: "POST",
                success: function (result) {
                    $("#participante_" + participanteID).find("i").toggleClass('fa fa-check fa fa-times');
                }
            });
        }


    </script>
}





